---
layout: post
title: "Walkthrough de la máquina Basic Pentesting (Vulnhub)"
author: "Pete"
---

Bienvenido de nuevo a la página. Llevaba varios meses con el blog parado, y he querido retomar los posts con un post muy especial, una resolución de una máquina de Vulnhub.

La máquina es bastante sencilla, pero sirve para desengrasasar (o coger desde 0, si fuese el caso!) los conocimientos de pentesting.

Un pequeño disclaimer antes de empezar ;) Esto se ha hecho en un entorno controlado y con una máquina que se ha generado para que sea explotada, ojo que no se puede hacer en máquinas para las que no se tenga autorización (es ilegal!).

# ¿Qué hace falta?
* Una máquina en la que trabajar. 
En mi caso, una Kali Linux de Offensive Security, pero puedes coger la que prefieras [Descarga Kali](https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-hyperv-image-download/).

* Una máquina vulnerable, que es la que vamos a resolver. 
En este caso la máquina es Basic Pentesting: 1 [Descarga](https://www.vulnhub.com/entry/basic-pentesting-1,216/).

# Preparación

Primero nos descargamos la OVA de la página de Vulnhub y la importamos en nuestro virtualbox, cambiando la configuración de red para poner la interfaz en "modo puente". De este modo vamos a simular tener varias tarjetas de red: una para el equipo anfitrión, otra para la máquina Kali, y otra para la máquina vulnerable; y cada una de ellas tendrá su dirección IP del mismo segmento de red, asignado por DHCP.

# Resolución

## Identificando la máquina

Antes de arrancar la máquina vulnerable, en la máquina Kali hacemos un 
* _arp-scan -l_ 

y vemos las máquinas que hay activas ahora mismo en la red. Iniciamos la máquina vulnerable y volvemos a hacer el escaneo arp
* _arp-scan -l_

Esta vez habrá una máquina más. Ya tenemos la IP de la máquina vulnerable :) En mi caso: 10.192.0.128

## Escaneo inicial

Empezamos lanzando el escáner de red nmap. He usado los flags 

* -A: para que detecte el sistema operativo y compruebe los servicios que hay en los puertos abiertos.
* -reason: para que muestre la razón por la que los puertos aparecerán abiertos/cerrados/filtrados.
* --top-ports: limitando a los 1000 puertos TCP más comunes. Si no encontrasemos nada aquí (o queremos probar otros vectores), habría que ir a por todos los puertos TCP y revisar también UDP.

![placeholder]({{ site.url }}/assets/img/0019_20180604_001.png)

El escaneo inicial nos indica que la máquina tiene los puertos de ftp, ssh y http abiertos.

## Evaluar los datos recogidos

Una vez que conocemos las versiones de software instaladas, revisamos si alguna tiene vulnerabilidades conocidas. Para ello se puede consultar la base de datos de exploit database.

Al ser también de la gente de Offensive Security, la base de datos está precargada en la Kali Linux que mantienen, por lo que no es necesario ir a la página en sí, y podemos usar 
* _searchsploit_

Por afinar la búsqueda, uso searchsploit y luego filtro con grep.

![placeholder]({{ site.url }}/assets/img/0020_20180604_002.png)

Bingo. Ese software, en esa versión, tiene vulnerabilidades conocidas.

## Explotación con Metasploit

La explotación con Metasploit de la vulnerabilidad es trivial. Arrancamos el Metasploit con
* _msfconsole_

y buscamos el exploit
* _search proftpd_

![placeholder]({{ site.url }}/assets/img/0021_20180604_003.png)

Ése es. Vamos a hacer la explotación:
* _use exploit/unix/ftp/proftpd_133c_backdoor_

Elegimos las opciones (en este caso únicamente indicar el objetivo):
* _show options_
* _set RHOST A.B.C.D_

y
* _run_

![placeholder]({{ site.url }}/assets/img/0022_20180604_004.png)

Se lanza el exploit, y tenemos nuestra shell... fácil y sencillo, aunque se echa en falta un poco de "cacharreo".

## Explotación sin Metasploit

Una vez visto que conseguir una shell de administrador en el sistema es trivial con Metasploit, vamos a probar otras maneras más manuales. Había otro exploit en exploit-db, así que vamos a echarle un ojo:

![placeholder]({{ site.url }}/assets/img/0023_20180604_005.png)

Viene con los comentarios de git y tiene pinta de que habrá que retocarlo un poco... Perezaca, la verdad es que sí.

Vamos a echar un ojo a ver si hay algún otro exploit por ahí... Miramos en Nmap, a ver si el NSE nos puede facilitar la vida.

[Scripts de Nmap en Github](https://github.com/nmap/nmap/tree/master/scripts)

Echándole un ojo, hay un script para verificar si la versión de proFTP que hay tiene backdoor. Lo probamos y funciona sin problemas (por defecto, ejecuta el comando "id"). 

![placeholder]({{ site.url }}/assets/img/0024_20180604_006.png)

Mirando la descripción del script, explica que se puede especificar el comando a ejecutar. Por ejemplo, con un "uptime".

![placeholder]({{ site.url }}/assets/img/0025_20180604_007.png)

Pues nada, vamos a ponernos a sacar una shell reversa. Dejamos el netcat escuchando, y nos mandamos la shell:

![placeholder]({{ site.url }}/assets/img/0026_20180604_008.png)

O no... o no tiene el netcat, o no acepta la opción "-e". Vamos a intentarlo con otro comando...

![placeholder]({{ site.url }}/assets/img/0027_20180604_009.png)

Tampoco... Vamos a probar de alguna otra manera. Toca tirar de [chuleta](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet) (la de veces que pude mirar la página durante el OSCP) y finalmente:

![placeholder]({{ site.url }}/assets/img/0028_20180604_010.png)

Listo! Ya tenemos nuestra shell :)

Para cualquier duda, comentario, etc., puedes ponerte en contacto a través de correo electrónico. Puedes encontrarlo [aquí](https://livefromsec.github.io/about/)
