---
layout: post
title: "Walkthrough de la máquina Basic Pentesting (Vulnhub)"
author: "Pete"
---

Bienvenido de nuevo a la página. Llevaba varios meses con el blog parado, y he querido retomar los posts con un post muy especial, una resolución de una máquina de Vulnhub.

La máquina es bastante sencilla, pero sirve para desengrasasar (o coger desde 0, si es el caso!) los conocimientos de pentesting.

Un pequeño disclaimer antes de empezar ;) Esto se hace en un entorno controlado y con una máquina que se ha generado para que sea explotada, ojo que no se puede hacer en máquinas para las que no se tenga autorización (es ilegal!).

# ¿Qué hace falta?
* Una máquina en la que trabajar. 
En mi caso, una Kali Linux de Offensive Security, pero puedes coger la que prefieras (https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-hyperv-image-download/).

* Una máquina vulnerable, que es la que vamos a resolver. 
En este caso la máquina es Basic Pentesting: 1 (https://www.vulnhub.com/entry/basic-pentesting-1,216/).

# Preparación

Primero nos descargamos la OVA de la página de Vulnhub y la importamos en nuestro virtualbox, cambiando la configuración de red para poner la interfaz en "modo puente". De este modo vamos a simular tener varias tarjetas de red: una para el equipo anfitrión, otra para la máquina Kali, y otra para la máquina vulnerable; y cada una de ellas tendrá su dirección IP del mismo segmento de red, asignado por DHCP.

# Resolución

## Identificando la máquina

Antes de arrancar la máquina vulnerable, en la máquina Kali hacemos un 
_arp-scan -l_ 
y vemos las máquinas que hay activas ahora mismo en la red. Iniciamos la máquina vulnerable y volvemos a hacer el escaneo arp
_arp-scan -l_

Esta vez habrá una máquina más. Ya tenemos la IP de la máquina vulnerable :) En mi caso: 10.192.0.128

## Escaneo inicial

Empezamos lanzando el escáner de red nmap. He usado los flags 

* -A: para que detecte el sistema operativo y compruebe los servicios que hay en los puertos abiertos.
* -reason: para que muestre la razón por la que los puertos aparecerán abiertos/cerrados/filtrados.
* --top-ports: limitando a los 1000 puertos TCP más comunes. Si no encontrasemos nada aquí (o queremos probar otros vectores), habría que ir a por todos los puertos TCP y revisar también UDP.

![placeholder]({{ site.url }}/assets/img/0019_20180604_001.png)

El escaneo inicial nos indica que la máquina tiene los puertos de ftp, ssh y http abiertos.

## Evaluar los datos recogidos

Una vez que conocemos las versiones de software instaladas, revisamos si alguna tiene vulnerabilidades conocidas. Para ello se puede consultar la base de datos de exploit database.

Al ser también de la gente de Offensive Security, la base de datos está precargada en la Kali Linux que mantienen, por lo que no es necesario ir a la página en sí, y podemos usar 
_searchsploit_

Por afinar la búsqueda, uso searchsploit y luego filtro con grep.

![placeholder]({{ site.url }}/assets/img/0020_20180604_002.png)

Bingo. Ese software, en esa versión, tiene vulnerabilidades conocidas.

## Explotación con Metasploit

La explotación con Metasploit de la vulnerabilidad es trivial. Arrancamos el Metasploit con
// comando
_msfconsole_

y buscamos el exploit
// comando
_search proftpd_

![placeholder]({{ site.url }}/assets/img/0021_20180604_003.png)

Ése es. Vamos a hacer la explotación:
_use exploit/unix/ftp/proftpd_133c_backdoor

Elegimos las opciones (en este caso únicamente indicar el objetivo):
// comando
_show options_
_set RHOST A.B.C.D_

y
// comando
_run_

![placeholder]({{ site.url }}/assets/img/0022_20180604_004.png)

Se lanza el exploit, y tenemos nuestra shell... fácil y sencillo, aunque se echa en falta un poco de "cacharreo".

## Explotación sin Metasploit

Una vez visto que conseguir una shell de administrador en el sistema es trivial con Metasploit, vamos a probar otras maneras más manuales. Había otro exploit en exploit-db, así que vamos a echarle miramos el exploit que hay en exploit-db. Perezaca, la verdad es que sí.

Miramos en nmap, a ver si el NSE nos puede facilitar la vida.

https://github.com/nmap/nmap/tree/master/scripts

Bingo, hay un script para verificar si la versión de proFTP que hay tiene backdoor.

con el script no sé qué, se ejecuta el comando id. y luego tiene la opción de especificar el comando que se va a ejecutar.

Vemos que funciona, y mejor aún, de acuerdo a la docmentación, podemos ejecutar código.

Vamos a traernos una shell reversa con nc.
intentamos una (con nc), y no sale,
intentamos otra (con bash) y tampoco sale.
En pentest monkey hay un listado de shells reversas, cogemos una última y con esta sale.

Comprobamos que tenemos la shell.



Blabla Keepassx

Bienvenid@ otra semana más a LiveFromSec. 

Para este viernes 24 (black friday!) me traigo la publicación de la versión final del OWASP top ten 2017. La versión preliminar (release candidate) fue publicada hace varios meses, antes de verano, y este lunes se ha publicado la versión final.

OWASP ([wiki](https://es.wikipedia.org/wiki/Open_Web_Application_Security_Project)) publica trianualmente su top ten de vulnerabilidades web. El pdf de este año lo puedes encontrar en su github [pdf](https://github.com/OWASP/Top10/blob/master/2017/OWASP%20Top%2010-2017%20(en).pdf)... y otra vez, la inyección SQL gana. Y eso que los prepared statements llevan entre nosotros mucho tiempo.

En la siguiente imagen puedes ver cómo queda el top ten, mapeado con el de la versión previa (2013):

![placeholder]({{ site.url }}/assets/img/0016_20171124_owasp_top_ten.png)

Los XSS caen 4 puntos, hasta la séptima posición; y los CSRF salen del top ten. El pódium lo completan los problemas con la autenticación (que repite en el segundo puesto) y la exposición de datos sensibles, que sube desde el sexto puesto al tercero.

![placeholder]({{ site.url }}/assets/img/0017_20171124_owasp_top_three.png)

En resumen, muy buen documento que **sintetiza en 20 páginas los principales riesgos a los que se enfrentan las aplicaciones web**.

Y aprovechando que es 24 de noviembre, pequeño offtopic: como es el black friday, te recomiendo que le eches un ojo a la página de Shodan. Shodan es un scanner de IPv4 en el que se puede encontrar muchísima información, y ha repetido su habitual promoción de una suscripción permanente por un precio irrisorio. Si te dedicas a la seguridad informática, seguro que lo conoces ;)
